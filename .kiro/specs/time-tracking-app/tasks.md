# 实施计划

- [x] 1. 项目初始化和依赖配置
  - 创建新的Android项目，配置Kotlin和Jetpack Compose
  - 添加所有必需的依赖项（Hilt, Room, Navigation, Coroutines）
  - 配置Hilt依赖注入
  - 设置项目模块结构（data, domain, presentation, di）
  - _需求: 9.1, 9.2_

- [x] 2. 数据层实现 - 数据库和实体
  - [x] 2.1 创建Room数据库实体类
    - 实现ActivityEntity和ActivityRecordEntity
    - 定义表关系和索引
    - _需求: 3.1, 3.2, 3.4_
  
  - [x] 2.2 实现DAO接口
    - 创建ActivityDao和ActivityRecordDao
    - 实现所有CRUD操作和查询方法
    - 使用Flow返回响应式数据
    - _需求: 1.1, 3.2, 4.2, 5.2, 6.1_
  
  - [x] 2.3 创建Room数据库类
    - 配置AppDatabase单例
    - 设置数据库版本和迁移策略
    - _需求: 3.2, 3.3_

- [x] 3. 数据层实现 - Repository
  - [x] 3.1 实现ActivityRepository
    - 创建Repository接口和实现类
    - 实现活动的增删改查功能
    - 添加获取活动总时长的方法
    - _需求: 1.2, 1.3, 1.4, 1.6_
  
  - [x] 3.2 实现ActivityRecordRepository
    - 创建Repository接口和实现类
    - 实现记录的创建和查询功能
    - 实现按日期范围和天查询的方法
    - 实现每日时长聚合查询
    - _需求: 2.5, 3.1, 6.1, 6.2_

- [x] 4. 领域层实现
  - [x] 4.1 创建领域模型
    - 定义Activity, ActivityWithDuration, ActivityRecord数据类
    - 定义TimerState密封类
    - 创建统计相关的数据模型（DailyStatistics, YearHeatmapData）
    - _需求: 1.1, 2.1, 4.1, 6.1_
  
  - [x] 4.2 实现核心Use Cases
    - 实现StartTimerUseCase
    - 实现SaveActivityRecordUseCase
    - 实现GetDailyStatisticsUseCase
    - 实现GetYearHeatmapDataUseCase
    - _需求: 2.1, 2.5, 4.2, 6.1_

- [x] 5. UI主题和通用组件
  - [x] 5.1 配置Material Design 3主题
    - 设置颜色方案（浅色和深色主题）
    - 配置Typography和Shape
    - 实现主题切换支持
    - _需求: 7.1, 7.4_
  
  - [x] 5.2 创建可复用的UI组件
    - 实现ActivityCard组件
    - 创建时间显示组件（格式化HH:MM:SS）
    - 实现确认对话框组件
    - _需求: 1.5, 7.1, 7.3_

- [x] 6. 主页面实现
  - [x] 6.1 实现HomeViewModel
    - 管理活动列表状态
    - 实现活动创建、编辑、删除逻辑
    - 处理活动卡片点击事件
    - _需求: 1.1, 1.2, 1.3, 1.4_
  
  - [x] 6.2 实现HomeScreen UI
    - 使用LazyVerticalGrid展示活动卡片
    - 每个卡片显示名称、图标、颜色和累计小时数
    - 添加FloatingActionButton用于创建新活动
    - 实现长按显示编辑/删除菜单
    - _需求: 1.1, 1.5, 1.6, 1.7, 7.2, 7.5_
  
  - [x] 6.3 实现活动创建/编辑对话框
    - 创建输入表单（名称、颜色选择、图标选择）
    - 实现表单验证
    - _需求: 1.2, 1.3_

- [x] 7. 计时器页面实现
  - [x] 7.1 实现TimerViewModel
    - 管理计时器状态（运行、暂停、空闲）
    - 使用Coroutine实现每秒更新
    - 实现暂停、继续、结束功能
    - 保存和恢复计时器状态（应对应用被杀死）
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 9.5_
  
  - [x] 7.2 实现TimerScreen UI
    - 全屏显示当前活动信息
    - 大号数字显示已用时间
    - 实现暂停/继续按钮
    - 实现结束按钮
    - 添加平滑的动画效果
    - _需求: 2.1, 2.2, 2.3, 2.4, 7.2, 7.3_

- [x] 8. 统计页面 - 基础框架
  - [x] 8.1 实现StatisticsViewModel
    - 管理视图模式状态（年/月/日）
    - 管理活动筛选状态
    - 加载和处理统计数据
    - _需求: 4.1, 5.1, 6.1, 8.1, 8.2_
  
  - [x] 8.2 实现StatisticsScreen基础布局
    - 创建顶部工具栏（视图模式切换器）
    - 实现活动筛选下拉菜单
    - 设置内容区域容器
    - _需求: 8.1, 8.2, 8.3, 8.4, 8.5_

- [x] 9. 统计页面 - 年度热力图视图
  - [x] 9.1 实现HeatmapView组件
    - 使用Canvas绘制12个月的网格
    - 实现颜色强度映射算法
    - 添加点击交互支持
    - 优化绘制性能
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_
  
  - [x] 9.2 集成年度视图到StatisticsScreen
    - 加载年度热力图数据
    - 处理日期点击事件
    - 添加加载状态和错误处理
    - _需求: 4.1, 4.6_

- [x] 10. 统计页面 - 月度视图
  - [x] 10.1 实现MonthView组件
    - 创建日历网格布局
    - 显示每日总时长
    - 实现月份导航
    - _需求: 5.1, 5.2, 5.3, 5.5_
  
  - [x] 10.2 集成月度视图到StatisticsScreen
    - 加载月度数据
    - 实现活动筛选
    - 显示月度总计
    - _需求: 5.1, 5.3, 5.4_

- [x] 11. 统计页面 - 日度视图
  - [x] 11.1 实现DayView组件
    - 创建活动记录列表
    - 显示每条记录的详细信息
    - 实现记录排序
    - _需求: 6.1, 6.2, 6.3_
  
  - [x] 11.2 集成日度视图到StatisticsScreen
    - 加载指定日期的记录
    - 显示日度总计
    - 实现记录点击查看详情
    - _需求: 6.1, 6.4, 6.5_

- [x] 12. 导航系统实现
  - [x] 12.1 配置Navigation Compose
    - 定义所有Screen路由
    - 实现NavHost
    - 配置参数传递
    - _需求: 2.1, 4.6, 6.5_
  
  - [x] 12.2 实现底部导航栏
    - 创建BottomNavigationBar组件
    - 配置主页和统计页面切换
    - 处理导航状态
    - _需求: 7.1_

- [x] 13. 后台计时和状态保持
  - [x] 13.1 实现计时器状态持久化
    - 使用SharedPreferences保存计时器状态
    - 在应用启动时恢复状态
    - _需求: 9.5_
  
  - [x] 13.2 处理配置变更
    - 确保屏幕旋转时保持状态
    - 处理应用进入后台的情况
    - _需求: 9.3, 9.5_

- [x] 14. 数据验证和错误处理
  - [x] 14.1 实现输入验证
    - 验证活动名称不为空
    - 验证时间记录的合法性
    - _需求: 1.2, 2.5_
  
  - [x] 14.2 实现错误处理机制
    - 在ViewModel中捕获和处理异常
    - 显示用户友好的错误消息
    - 实现重试机制
    - _需求: 7.3_

- [x] 15. UI优化和动画
  - [x] 15.1 添加页面转场动画
    - 实现滑动转场效果
    - 添加淡入淡出动画
    - _需求: 7.2_
  
  - [x] 15.2 优化交互反馈
    - 添加卡片点击动画
    - 实现按钮点击涟漪效果
    - 确保所有交互在100ms内响应
    - _需求: 7.3, 7.5_

- [x] 16. 响应式布局适配
  - [x] 16.1 实现多屏幕尺寸支持
    - 适配手机竖屏布局
    - 适配手机横屏布局
    - 优化平板显示
    - _需求: 9.2, 9.3_
  
  - [x] 16.2 测试不同设备
    - 在不同屏幕尺寸上测试
    - 验证触摸目标大小
    - _需求: 7.5, 9.2_

- [ ] 17. 测试实现
  - [x] 17.1 编写ViewModel单元测试
    - 测试HomeViewModel逻辑
    - 测试TimerViewModel状态转换
    - 测试StatisticsViewModel数据加载
    - _需求: 所有功能需求_
  
  - [x] 17.2 编写Repository测试
    - 使用In-Memory数据库测试
    - 验证数据持久化
    - 测试查询逻辑
    - _需求: 3.1, 3.2, 3.3_
  
  - [ ] 17.3 编写UI测试
    - 测试主页面交互
    - 测试计时器功能
    - 测试统计页面显示
    - _需求: 所有UI需求_

- [ ] 18. 最终集成和调试
  - [ ] 18.1 端到端功能测试
    - 测试完整的计时流程
    - 验证数据统计准确性
    - 测试应用在各种场景下的稳定性
    - _需求: 所有需求_
  
  - [ ] 18.2 性能优化
    - 优化数据库查询
    - 减少不必要的UI重组
    - 测试内存使用
    - _需求: 7.2, 7.3_
  
  - [ ] 18.3 最终UI调整
    - 调整颜色和间距
    - 确保Material Design一致性
    - 优化视觉效果
    - _需求: 7.1, 7.4_
